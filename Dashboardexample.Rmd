---
title: "Example Monitoring Dashboard"
author: "Tyler Bosch"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE, cache=TRUE}
library(flexdashboard)
library(reshape2)
library(lubridate)
library(dplyr)
library(ggplot2)
library(data.table)
library(tidyr)
library(DT)
library(shiny)
library(ggrepel)
library(gridExtra)
library(ggrepel)
library(chron)
library(d3heatmap)
library(plotly)
library(tidyverse)
library(tibble)
library(zoo)
```

```{r load_wellness_data, include=FALSE, cache=TRUE}
DF_wellness <- read.csv("wellness_deidentified.csv")
DF_wellness$Date <- ymd(DF_wellness$newdate)
DF_wellness$day <- lubridate::wday(DF_wellness$Date, label = TRUE, abbr = FALSE)
DF_wellness$Name <- factor(DF_wellness$id, levels = rev(sort(unique(DF_wellness$id))))
```

```{r include=FALSE}

VB_D_RPE <- DF_wellness[,c("Date","Name", "id", "day", "RPE", "Cog_RPE", "B_RPE", "M_RPE")]
VB_D_RPE_update <- na.omit(VB_D_RPE)

VB_D_RPE_update$Cog_RPE_S <- ave(VB_D_RPE_update$Cog_RPE, VB_D_RPE_update$Name, VB_D_RPE_update$day, FUN=scale)
VB_D_RPE_update$B_RPE_S <- ave(VB_D_RPE_update$B_RPE, VB_D_RPE_update$Name, VB_D_RPE_update$day, FUN=scale)
VB_D_RPE_update$M_RPE_S <- ave(VB_D_RPE_update$M_RPE, VB_D_RPE_update$Name, VB_D_RPE_update$day, FUN=scale)
VB_D_RPE_2 <-
  VB_D_RPE %>%
  filter(Date==max(Date))
```

```{r load_gps_data, include=FALSE, cache=TRUE}
catdata <- read.csv("catdata.csv")
```

```{r include=FALSE }
catdata$Date <- as.Date(catdata$Date, format ="%m/%d/%y")
 catdata$Week <- lubridate::isoweek(ymd(catdata$Date))
catdata$day <- weekdays(as.Date(catdata$Date))
  catdata$day <- as.factor(catdata$day)
  catdata$day <- factor(catdata$day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday","Sunday"))
catdata$Duration_minutes <- 60 * 24 * as.numeric(times(catdata$Duration))
catdata$Player_Load_minute <- catdata$Player.Load/catdata$Duration_minutes
catdata$Meters_minute <- catdata$Odometer/catdata$Duration_minutes
catdata <- transform(catdata, id=match(Player.Name, unique(Player.Name)))
  catdata$id <- paste("Player", catdata$id, sep = "_")


 Catapult_daily <-
  catdata %>%
  filter(Period.Number < 1)
Catapult_daily <-
  Catapult_daily %>%
  filter(Period.Name != "Fitness ")
Catapult_daily <-
  Catapult_daily %>%
  filter(Period.Name != "Fitness PM")
Catapult_daily <-
  Catapult_daily %>%
  filter(Period.Name != "Fitness PM Session")
Catapult_daily <-
  Catapult_daily %>%
  filter(Period.Name != "Fitness")
Catapult_daily$Period.Name <- ifelse(Catapult_daily$Period.Name == "-4Day", "-4 Day", as.character(Catapult_daily$Period.Name))
Catapult_daily$Meters_scale <- ave(Catapult_daily$Odometer, Catapult_daily$Player.Name, FUN=scale)
Catapult_daily$PL_scale <- ave(Catapult_daily$Player.Load, Catapult_daily$Player.Name,  FUN=scale)
Catapult_daily$Type <- ifelse(Catapult_daily$Period.Name != "-6 Day" & Catapult_daily$Period.Name != "-5 Day" & Catapult_daily$Period.Name != "-4 Day" & Catapult_daily$Period.Name != "-3 Day" & Catapult_daily$Period.Name != "-2 Day" & Catapult_daily$Period.Name != "-1 Day" & Catapult_daily$Period.Name != "-2 Day Regen" & Catapult_daily$Period.Name != "-4 Day PM", "Match", as.character(Catapult_daily$Period.Name))
cat_avg <- Catapult_daily %>% group_by(Player.Name, Type) %>% summarize(PLmean = mean(Player.Load, na.rm=T), PLsd = sd(Player.Load, na.rm=T))
Catapult_daily <- setDF(setDT(Catapult_daily)[setDT(cat_avg), PLmean :=PLmean, on = c("Player.Name", "Type")])
Catapult_daily <- setDF(setDT(Catapult_daily)[setDT(cat_avg), PLsd :=PLsd, on = c("Player.Name", "Type")])
Catapult_daily$Total_Player.Load <- ave(Catapult_daily$Player.Load, Catapult_daily$Player.Name, Catapult_daily$Week, FUN=sum)
Catapult_daily$Total_Distance <- ave(Catapult_daily$Odometer, Catapult_daily$Player.Name, Catapult_daily$Week, FUN=sum)
Catapult_daily$HSR_Distance <- ave(Catapult_daily$Velocity.Band.5.Dist, Catapult_daily$Player.Name, Catapult_daily$Week, FUN=sum)
Catapult_daily$Sprint_Distance <- ave(Catapult_daily$Velocity.Band.6.Dist, Catapult_daily$Player.Name, Catapult_daily$Week, FUN=sum)
Catapult_daily$Percent_HSR <- Catapult_daily$Sprint_Distance/Catapult_daily$Total_Distance *100
Catapult_daily$min_day_week <- ave(Catapult_daily$Date, Catapult_daily$Week, FUN=min)
Catapult_daily$max_day_week <- ave(Catapult_daily$Date, Catapult_daily$Week, FUN=max)
Catapult_daily$Week2 <- paste(Catapult_daily$min_day_week, Catapult_daily$max_day_week, sep="-")
Catapult_daily_today <- Catapult_daily %>% filter(Date==max(Date))
Catapult_daily_mean <- Catapult_daily %>% group_by(Date, Type, Period.Name, Week) %>% summarize(Player_Load_mean = mean(Player.Load, na.rm=T), Player_Load_max = max(Player.Load, na.rm=T), Total_distance_mean = mean(Odometer, na.rm=T), Total_distance_max = max(Odometer, na.rm=T), Meters_minute_mean = mean(Meters_minute, na.rm=T), Meters_minute_max = max(Meters_minute, na.rm=T), PL_scale = mean(PL_scale, na.rm=T), Meters_scale = mean(Meters_scale, na.rm=T), PLmean = mean(PLmean, na.rm=T), PLsd = mean(PLsd, na.rm=T))

drills_compare <- read.csv("drills_compare.csv")

Soccer_data <- read.csv("Soccer_data_final_reg_season.csv")
Soccer_data <- Soccer_data[,c(2:26)]

Passing <- read.csv("passing_data_final_reg_season.csv")

 ACWR_Solver <- read.csv("ACWR_Solver.csv")
 
 
Passing2 <- read.csv("Passing_2018.csv") 
colnames(Passing2)[5] <- "Club"
```

Wellness
================================================

Row (data-width = 1500)
--------------------------------

<h3>Date</h3>
```{r}
latest_wellness_date <- max(DF_wellness$Date)

wellness_date_format <- "%b %d %Y"
last_30_wellness_dates <- head(unique(format(sort(DF_wellness$Date, decreasing = TRUE), format = wellness_date_format)), 21)
selectInput("wellness_date", NULL, last_30_wellness_dates, selected = format(latest_wellness_date, format=wellness_date_format))
```


```{r, include=FALSE}
wellness_date <- reactive({
  mdy(input$wellness_date)
})
```

<h3>Compliance</h3>
```{r}

compliance_data <- reactive({
  wellness_day_data <- DF_wellness %>%
    filter(Date == wellness_date())
  
  data.frame(Name = unique(DF_wellness$Name)) %>% 
    merge(wellness_day_data %>% select(Name, Wellness_Total), all.x = TRUE) %>% 
    mutate(Screened = !is.na(Wellness_Total))
})

compliance_guage <- reactive({

  rate <- compliance_data() %>% 
    summarise(compliance_rate = mean(Screened == TRUE) * 100) %>% 
    .$compliance_rate

  gauge(rate, min = 0, max = 100, symbol = '%', gaugeSectors(
    success = c(80, 100), warning = c(50, 79), danger = c(0, 49)
  ))
})

renderGauge({
  compliance_guage()
})
```

<h3>Missing</h3>
<div style = "color: #f6d40a; margin: 0px 0px 0px 10px;">
```{r, echo=FALSE}
non_compliant_athletes <- reactive({
  names <- compliance_data()$Name[compliance_data()$Screened == FALSE]
})

renderUI({
  HTML(paste(non_compliant_athletes(), collapse = "<br />"))
})
```
</div>

Row {.tabset}
----------------------------

###Wellness 

```{r, echo = FALSE, include = FALSE}
daily_wellness_data <- reactive({
  DF_wellness %>% filter(Date == wellness_date())
})
```


```{r, echo=FALSE}
renderPlot({
  daily_data <- daily_wellness_data()
  
  # Set ordering by daily Well_S
  daily_data$Name <- reorder(daily_data$Name, -daily_data$Well_S)
  Daily <- ggplot(daily_data, aes(Name, Well_S, fill=Well_S)) +
    geom_bar(stat="identity", color = "black") + 
    geom_rect(aes(ymin = -Inf, ymax = -2.5, xmin = -Inf, xmax = Inf), fill = "pink", alpha = 1/100) +
    geom_rect(aes(ymin = -2.5, ymax = 0, xmin = -Inf, xmax = Inf), fill = "yellow", alpha = 1/100) +
    geom_rect(aes(ymin = 0, ymax = Inf, xmin = -Inf, xmax = Inf), fill = "green", alpha = 1/100) +
    scale_fill_gradient2(name="Wellness", low='red', mid= "yellow", high='green', midpoint=0, guide = FALSE) +
    scale_x_discrete(name="") + 
    theme_minimal() +
    theme(axis.text.x= element_text(angle=90)) +
    ggtitle("Daily Wellness") +
    ylab("Scaled Wellness < 0 is below their average") + 
    coord_flip() 
  
  start_date <- wellness_date() - days(7)
  weekly_data <- DF_wellness %>% filter(Date > start_date, Date <= wellness_date())
  
  # Specify ordering so same as partner daily graph
  weekly_data$Name <- factor(weekly_data$Name, levels = rev(levels(daily_data$Name)))
  
  Weekly <- ggplot(weekly_data, aes(Date, Well_S, colour=Well_S)) +
    geom_point(size=2) + 
    geom_line() + 
    scale_colour_gradient(low="red", high="green", guide = FALSE) +
    geom_hline(yintercept= 0, lty=3) +
     geom_hline(yintercept= -2, lty=2, colour="red") +
    facet_grid(Name ~., switch = "y") +
    scale_x_date(date_breaks = "1 day", date_labels =  "%a %d") +
    theme(axis.title=element_blank(), 
          axis.ticks.y = element_blank(),
          axis.text.y = element_blank(),
          panel.background = element_rect(fill = 'white'),
          strip.background = element_blank(),
          strip.text.y = element_text(angle = 180),
          panel.spacing = unit(0.9, "null"),
          plot.margin = unit(c(0.90,0.5,0.90,0.5), "cm")) + 
    ggtitle("Weekly Wellness") +
    ylab("black = average, red = very low")

  grid.arrange(Daily, Weekly, ncol=2)
})
```

###Running Team Avg Wellness Scaled
```{r, echo=FALSE, fig.height=20, fig.width=40}

renderPlot({
  last_21_days <- DF_wellness %>% filter(Date >= wellness_date - days(21))
  
  last_21_days_data <- last_21_days %>%
    mutate(Wellness_status = cut(Wellness_Total_Scale, breaks=c(-Inf, -1.5, 1, Inf), labels=c("red", "yellow", "green")))
  
  last_21_days_squad_avg_data <- last_21_days %>%
    group_by(Date) %>%
    summarize(Wellness_Total_Scale = mean(Wellness_Total_Scale, na.rm=T), 
              Wellness_status = cut(Wellness_Total_Scale, breaks=c(-Inf, -1.5, 1, Inf), labels=c("red","yellow","green")))
  
  shapes <- c(25,21,24)
  names(shapes) <- c("red", "yellow", "green")
  
  ggplot(last_21_days_data, aes(Date, Wellness_Total_Scale)) + 
    geom_bar(data = last_21_days_squad_avg_data, aes(fill = Wellness_status), stat="summary", fun.y="mean") + 
    geom_line(data = last_21_days_squad_avg_data, stat="summary", fun.y="mean", alpha = 8/10, linetype="dotted", size = 3) + 
    geom_point(aes(shape = Wellness_status, fill= Wellness_status), stat="identity", alpha=5/10) + 
    geom_text_repel(data=last_21_days_data %>% filter(Wellness_Total_Scale < -2.5), aes(label=Name)) + 
    
    scale_shape_manual(values = shapes, guide = FALSE) +
    scale_fill_identity() + 
    scale_x_date(date_breaks = "1 day", date_labels =  "%a %d") +
    
    theme_minimal() +
    theme(axis.text.x= element_text(angle=45),
          panel.grid.minor = element_blank()) +
    
    ggtitle("21 Day Wellness v Squad Average") +
    ylab("Wellness Scaled") +
    xlab(NULL)
})
```


###Differentiated RPE
```{r, echo=FALSE, fig.height=25, fig.width=35}
VB_D_RPE_2 <-
  VB_D_RPE %>%
  filter(Date==max(Date))

VB_D_RPE_2$Date <- format(VB_D_RPE_2$Date, "%a %b %d")
VB_D_RPE_3 <- VB_D_RPE_2[,c("Name", "Cog_RPE", "B_RPE", "M_RPE")]
VB_D_RPE_melt <- melt(VB_D_RPE_3, id.var = "Name")
VB_D_RPE_melt$value <- as.numeric(as.character(VB_D_RPE_melt$value))
renderPlot({
ggplot(VB_D_RPE_melt, aes(variable, value, fill=variable))+geom_bar(stat="identity")+coord_polar(theta = "y", start = 0)+facet_wrap(~Name)+ggtitle(max(VB_D_RPE_2$Date))+xlab("")+ylab("Max is 5, higher equals easier")
})
```

###Player Report Card Scaled
```{r, echo=FALSE}
VB4 <-
  DF_wellness %>%
  filter(Date==max(Date))

VB4$Date <- format(VB4$Date, "%a %b %d")
renderPlot({
VB5 <-VB4[,c("Name", "SL_S", "RPE_S", "Sore_S", "Stress_S", "SQ_S")]
VB5_melt <- melt(VB5, id.vars = "Name")
ggplot(VB5_melt, aes(reorder(Name, value), value, fill=variable))+geom_bar(stat="identity")+coord_flip()+xlab("Athlete")+ylab("Scaled Value for Wellness")+ggtitle(max(VB4$Date))+geom_hline(yintercept = -2.5, colour="red", lty=2)+geom_hline(yintercept = -1, colour="yellow", lty=1, size = 2)+geom_text(aes(Name, value, label=round(value,1)), position=position_stack(vjust=0.5))
})
```


Column (data-width=200)
--------------------------

Alerts

### Sleep Quality < -1.0 {data-height=200}
<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderUI({
  names <- daily_wellness_data()$Name[daily_wellness_data()$SQ_S < -1.0 ]
  HTML(paste(names, collapse = "<br />"))
})
```
</div>

### Sleep Length < -1.0 {data-height=200}
<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderUI({
  names <- daily_wellness_data()$Name[daily_wellness_data()$SL_S < -1.0 ]
  HTML(paste(names, collapse = "<br />"))
})
```
</div>

### RPE < -1.0 {data-height=200}
<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderUI({
  names <- daily_wellness_data()$Name[daily_wellness_data()$RPE_S < -1.0 ]
  HTML(paste(names, collapse = "<br />"))
})
```
</div>

### Soreness < -1.0 {data-height=200}

<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderUI({
  names <- daily_wellness_data()$Name[daily_wellness_data()$Sore_S < -1.0 ]
  HTML(paste(names, collapse = "<br />"))
})
```
</div>

### Stress < -1.0 {data-height=200}

<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderUI({
  names <- daily_wellness_data()$Name[daily_wellness_data()$Stress_S < -1.0 ]
  HTML(paste(names, collapse = "<br />"))
})
```
</div>


Coaches Report
===================

Column {.tabset}
-------------------

###Player Report
```{r,echo=FALSE}
renderPlot({

ggplot(data=subset(catdata, Position %in% c("F", "M", "D") & Date >= max(Date) & Period.Number > 0), aes(reorder(Period.Name, Period.Number), Player.Load, fill=Meters_minute))+geom_bar(stat="identity")+facet_wrap(~id)+geom_text(aes(y=5,label=Period.Name), angle=90, hjust=-.1, size=3)+theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+scale_fill_gradient2(low="yellow", mid="green", high="red")
})
```


###ACR Table

```{r, echo=FALSE}
renderDataTable({
  ACWR_Solver$ACR_weighted <- round(ACWR_Solver$ACR_weighted, 2)
  datatable(ACWR_Solver,extensions= c('Scroller', 'FixedColumns'), options = list(
    scrollY = 400, paging = TRUE, scrollX = TRUE, fixedColumns = list(leftColumns= 1)), rownames = FALSE)%>%  
    formatStyle('Player.Load', background =  styleColorBar(range(ACWR_Solver$Player.Load) , 'lightblue'),  backgroundSize = '95% 50%', backgroundRepeat = 'no-repeat', backgroundPosition = 'center') %>%  
    formatStyle('Odometer', background =  styleColorBar(range(ACWR_Solver$Odometer), 'lightblue'),  backgroundSize = '95% 50%', backgroundRepeat = 'no-repeat',backgroundPosition = 'center') %>%  formatStyle('ACR_weighted', 'ACR_weighted', backgroundColor = styleInterval(c(0.8,1.3), c('yellow', 'green', 'red')))
})

```

###Days Since Max Velocity
```{r,echo=FALSE}
renderDataTable({
  SeasonData <- catdata
SeasonData2 <- SeasonData %>% filter(Period.Number < 1)
SpeedData <- SeasonData2 %>% select (id, Date, Week, Max.Velocity, Velocity.Band.5.TotEff, Velocity.Band.6.TotEff)
SpeedData <- SpeedData %>% group_by(id) %>% mutate(PercentOfMax = round(Max.Velocity/max(Max.Velocity)*100,1))
SpeedData <- SpeedData %>% group_by(id) %>% mutate(DateofLastMax90 = max(Date[which(PercentOfMax>90)]),
                                                   DateofLastMax80 = max(Date[which(PercentOfMax>80)]),
                                                   DateOfLast80Effort = max(Date[which(Velocity.Band.5.TotEff >0)]),
                                                   DateOfLast90Effort = max(Date[which(Velocity.Band.6.TotEff >0)]))

SpeedData_New <- SpeedData %>% filter(Date >= max(Date))
SpeedData_New$DaysSinceMax90 <- as.Date(as.character(SpeedData_New$Date), format="%Y-%m-%d")-
  as.Date(as.character(SpeedData_New$DateofLastMax90), format="%Y-%m-%d")
SpeedData_New$DaysSince90Effort <- as.Date(as.character(SpeedData_New$Date), format="%Y-%m-%d")-
  as.Date(as.character(SpeedData_New$DateOfLast90Effort), format="%Y-%m-%d")
SpeedData_New$DaysSinceMax80 <- as.Date(as.character(SpeedData_New$Date), format="%Y-%m-%d")-
  as.Date(as.character(SpeedData_New$DateofLastMax80), format="%Y-%m-%d")
SpeedData_New$DaysSince80Effort <- as.Date(as.character(SpeedData_New$Date), format="%Y-%m-%d")-
  as.Date(as.character(SpeedData_New$DateOfLast80Effort), format="%Y-%m-%d")
SpeedData_table <- SpeedData_New %>% filter(Date >="2017-10-12") %>% select(id, Date, Max.Velocity, DaysSinceMax90, DaysSince90Effort, DaysSinceMax80, DaysSince80Effort)
SpeedData_table$Max.Velocity <- round(SpeedData_table$Max.Velocity, 2)
datatable(SpeedData_table, extensions= c('Scroller', 'FixedColumns'), options = list(scrollY = 400, paging = TRUE, scrollX = TRUE, fixedColumns = list(leftColumns= 4))
) %>%  formatStyle('id', 'DaysSinceMax90', backgroundColor = styleInterval(c(3,7), c('green', 'yellow', 'red'))) %>%  formatStyle('DaysSinceMax90', 'DaysSinceMax90', backgroundColor = styleInterval(c(3,7), c('green', 'yellow', 'red'))
) %>%  formatStyle('DaysSinceMax80', 'DaysSinceMax80', backgroundColor = styleInterval(c(3,7), c('green', 'yellow', 'red'))
) %>%  formatStyle('Max.Velocity', background =  styleColorBar(range(SpeedData_table$Max.Velocity), 'lightblue')) 




  
})

```


Player Report
====================
  
Column {.sidebar}
-------------------
  
###Player Select
```{r,echo=FALSE}

selectInput("Player_report", "Select Athlete", catdata$id, selected = catdata$id[[8]])
```

Column  {data-width=500}
---------------------------------
  
### Daily Load
```{r, echo=FALSE}



barplot1 <- reactive({
  player_drills <- catdata %>%
    filter(id == input$Player_report,
           Date >= max(Date), Period.Number > 0)
  
  ggplot(player_drills, aes(reorder(Period.Name, Period.Number), Player.Load, fill=Meters_minute))+geom_bar(stat="identity")+facet_wrap(~id)+geom_text(aes(y=5,label=Period.Name), angle=90, hjust=-.1, size=3)+theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+scale_fill_gradient2(low="yellow", mid="green", high="red")
})

renderPlot({
  barplot1()
})

```

###Loading
```{r, echo=FALSE,}

barplot2 <- reactive({
 
  catdata$day <- weekdays(as.Date(catdata$Date))
  catdata$day <- as.factor(catdata$day)
  catdata$day <- factor(catdata$day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday","Sunday"))
  plot2 <-
    catdata %>%
    filter(id == input$Player_report, 
           Date > max(Date) - days(21), Period.Number < 1) %>%
    group_by(id, Date, day) %>%
    select(id, Date, day, Player.Load, Odometer, Meters_minute)
  
  ggplot(plot2, aes(Date, Player.Load, fill=Meters_minute))+geom_bar(stat="identity")+scale_fill_gradient2(low="yellow", mid="green", high="red", midpoint=50)+geom_text(aes(Date, y= 5, label = day), angle = 90, hjust= -.2)+geom_text(aes(x=Date, y= Player.Load, label=round(Meters_minute,2)), angle = 90, hjust = 1)+theme(axis.text=element_text(size=12),axis.title=element_text(size=14,face="bold"),plot.title = element_text(size = 20, face = "bold"))+xlab("Date")+ylab("Player Load(au) ")+ggtitle("Chronic (3week) Loading")
})

renderPlot({
  barplot2()
})

```

Column {data-width=500}
----------------
  
### Player Load Range and Day
```{r, echo=FALSE}

barplot3 <- reactive({
   plot3 <-
    catdata %>%
    filter(id == input$Player_report, 
          Period.Number < 1)
  ggplot(plot3, aes(day, Player.Load))+geom_violin(stat="ydensity")+geom_point(data=subset(plot3, Date >= max(Date) - lubridate::days(7)),colour="red", size = 3)+geom_text(data=subset(plot3, Date >= max(Date) - lubridate::days(7)), aes(label=round(Player.Load,0)), colour="red", size = 4, vjust=-.5) +coord_flip()+theme(axis.text=element_text(size=12),axis.title=element_text(size=14,face="bold"),plot.title = element_text(size = 14, face = "bold"))+xlab(" ")+ylab("Player Load (au) ")+ggtitle("Range of PL with Today's PL (Red Dot)")
})

renderPlot({
  barplot3()
})

```


###Distance Covered 
```{r, echo=FALSE}
barplot4 <- reactive({
  plot4 <-
    catdata %>%
    filter(id == input$Player_report, 
          Period.Number < 1)
  
  ggplot(plot4, aes(day, Odometer))+geom_violin(stat="ydensity")+geom_point(data=subset(plot4, Date >= max(Date) - lubridate::days(7)),colour="red", size = 3)+geom_text(data=subset(plot4, Date >= max(Date) - lubridate::days(7)), aes(label=round(Odometer,0)), colour="red", size = 4, vjust=-.5)+coord_flip()+theme(axis.text=element_text(size=12),axis.title=element_text(size=14,face="bold"),plot.title = element_text(size = 14, face = "bold"))+xlab(" ")+ylab("Distance (m) ")+ggtitle("Range of Dist with Today's Dist (Red Dot)")
})

renderPlot({
  barplot4()
})

```

Column {data-width=200}
--------------------------

Alerts

### Player Load low < -1.5 {data-height=200}

<div style = "color: #f6d40a">
```{r, echo=FALSE}
renderPrint({
  names <- Catapult_daily$id[Catapult_daily$Date >= max(Catapult_daily$Date) & Catapult_daily$PL_scale < -1.5 ]

  HTML(paste(names, collapse = "<br />"))
})
```
</div>

### Distance Low < -1.5 {data-height=200}

<div style = "color: #f6d40a">
```{r, echo=FALSE}
renderPrint({
  names <- Catapult_daily$id[Catapult_daily$Date >= max(Catapult_daily$Date) & Catapult_daily$Meters_scale < -1.5 ]
   HTML(paste(names, collapse = "<br />"))
})
```
</div>

### Player Load High > 2.0 {data-height=200}

<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderPrint({
  names <- Catapult_daily$id[Catapult_daily$Date >= max(Catapult_daily$Date) & Catapult_daily$PL_scale >= 1.5 ]
   HTML(paste(names, collapse = "<br />"))
})
```
</div>

### Distance High > 2.0SD {data-height=200}

<div style = "color: #f02c2c">
```{r, echo=FALSE}
renderPrint({
  names <- Catapult_daily$id[Catapult_daily$Date >= max(Catapult_daily$Date) & Catapult_daily$Meters_scale >= 1.5 ]
   HTML(paste(names, collapse = "<br />"))
})
```
</div>



Daily and Running Totals {data-navmenu="Monitoring"}
==================================================

Column {.tabset}
------------------

###Daily Load Comparison to Player Avg
```{r, echo=FALSE}

renderPlotly({
  Catapult_daily_today <- transform(Catapult_daily_today, id=match(Player.Name, unique(Player.Name)))
  Catapult_daily_today$id <- paste("Player", Catapult_daily_today$id, sep = "_")
Catapult_daily_today$cols <- ifelse(Catapult_daily_today$Player.Load > 350, "red", ifelse(Catapult_daily_today$Player.Load <250, "yellow", "green"))
  
b <- ggplot(Catapult_daily_today, aes(id, Player.Load))+geom_point(aes(colour = cols), stat="identity", size=4)+scale_color_identity()+geom_point(aes(id, PLmean), shape = 23)+geom_errorbar(aes( x=id, Player.Load, ymin=PLmean-PLsd *.5, ymax = PLmean + PLsd*.5 ))+coord_flip()+ggtitle(print(Catapult_daily_today$Period.Name))
ggplotly(b)
})
```

###Cumulative Team Load per day
```{r, echo=FALSE}

renderPlot({

  ggplot(Catapult_daily, aes(Date, Player.Load, fill=Odometer))+geom_bar(stat="identity")+facet_wrap(~Week, scale="free_x")+geom_text(aes(Date, 100, label=Period.Name), stat="summary", fun.y="mean", angle=90, colour="black", hjust= -.1)+scale_fill_gradient2(low="yellow", mid="green", high="red")
})
```

###Avg Load per day
```{r, echo=FALSE}
renderPlot({
 
ggplot(Catapult_daily_mean, aes(Date, Player_Load_mean, fill=Meters_minute_mean))+geom_bar(stat="summary", fun.y="mean")+facet_wrap(~Week, scale="free_x")+geom_text(aes(Date, 100, label=Period.Name), stat="summary", fun.y="mean", angle=90, colour="black", hjust= -.1, size=2.5)+scale_fill_gradient2(name="Avg Meters/min\n(intensity)",low="yellow", mid="green", high="red")+ylab("Average PlayerLoad (Volume)")+geom_point(aes(Date, PLmean), shape=23, size=2, fill = "green", colour="green")+geom_errorbar(aes(Date, PLmean, ymin=PLmean-PLsd*.5, ymax=PLmean+PLsd*.5), color="green")
})
```


Drill Breakdown {data-navmenu="Monitoring"}
===============================================

Column {.sidebar}
--------------------

###Select Drill Type
```{r, echo=FALSE}

selectInput("Type", "Type", choices = drills_compare$Type, selected = drills_compare$Type[[3]], multiple = TRUE )
```

Column
-----------

###Player Load
```{r, echo=FALSE}
renderPlot({
 ggplot(data=subset(drills_compare, Type %in% input$Type), aes(reorder(Period.Name, Player_Load_minute), Player_Load_minute, fill=Meters_minute))+geom_bar(stat="identity")+scale_fill_gradient2(name="Meters/minute", low="green", mid="yellow", high="red", midpoint=50)+facet_wrap(~Type, scale="free")+coord_flip()+xlab("Drill Name")+ylab("Player Load/Minute")

}
)
```

Monitoring Dashboard {data-navmenu="Monitoring"}
===============================================

Column {.sidebar}
------------------
```{r, echo=FALSE}
selectInput("week", "Week", choices = Catapult_daily$Week2, selected=Catapult_daily$Week2[Catapult_daily$Week >= max(Catapult_daily$Week)], multiple = TRUE)

selectInput("TD", "Training Day", choices = Catapult_daily$Period.Name, selected= c("-3 Day", "-2 Day", "-1 Day"), multiple=TRUE)

Catapult_daily <- transform(Catapult_daily, id=match(Player.Name, unique(Player.Name)))
  Catapult_daily$id <- paste("Player", Catapult_daily$id, sep = "_")
Player.Names <-
  Catapult_daily %>%
  group_by(Player.Name) %>%
  summarize(PL = mean(Player.Load, na.rm=T))

Player.Names<- transform(Player.Names, id2=match(Player.Name, unique(Player.Name)))
  Player.Names$id <- paste("Player", Player.Names$id2, sep = "_")
checkboxGroupInput("player", "Athlete", choices = Player.Names$id, selected = Player.Names$id, inline=TRUE)
```

Column {.tabset}
-----------------

###Player Load
```{r, echo=FALSE}
renderPlot({

  filtered <- 
    Catapult_daily %>%
    filter(Week2 %in% input$week, id %in% input$player, Period.Name %in% input$TD)
  ggplot(filtered, aes(reorder(id, Total_Player.Load), Player.Load, fill=Velocity.Band.5.Dist))+geom_bar(stat="identity", position="stack")+scale_fill_gradient2(name="HSR_distance",low="yellow", mid="green", high="red")+facet_wrap(~Week2, scale="free_y")+coord_flip()+xlab("Player Name")+ylab("Total Player Load")+facet_wrap(~Week2, scale="free_y")+geom_text(aes(label=Period.Name), position=position_stack(vjust=.2))
}
)
```

###Total Distance adjusted for HSR
```{r, echo=FALSE}

 renderPlot({
 
  filtered <- 
    Catapult_daily %>%
    filter(Week2 %in% input$week, id %in% input$player, Period.Name %in% input$TD)
  ggplot(filtered, aes(reorder(id, Total_Distance), Odometer, fill=Velocity.Band.5.Dist))+geom_bar(stat="identity", position="stack")+scale_fill_gradient2(name="HSR_Distance",low="yellow", mid="green", high="red")+coord_flip()+xlab("Player Name")+ylab("Total Distance")+facet_wrap(~Week2, scale="free_y")+geom_text(aes(label=Period.Name),  position=position_stack(vjust=0.2))

}
)
```


###HSR Distance adjusted for Sprint Distance
```{r, echo=FALSE}
 renderPlot({

  filtered <- 
    Catapult_daily %>%
    filter(Week2 %in% input$week, id %in% input$player, Period.Name %in% input$TD)
  ggplot(filtered, aes(reorder(id, HSR_Distance), Velocity.Band.5.Dist, fill=Velocity.Band.6.Dist))+geom_bar(stat="identity", position="stack")+scale_fill_gradient2(name="Sprint Distance",low="yellow", mid="green", high="red")+coord_flip()+xlab("Player Name")+ylab("HSR Distance")+facet_wrap(~Week2, scale="free_y")+geom_text(aes(label=Period.Name), position=position_stack(vjust=0.2))

}
)
```

###Max Velocity
```{r, echo=FALSE}
 renderPlot({
  
  filtered <- 
    Catapult_daily %>%
    filter(Week2 %in% input$week, id %in% input$player, Period.Name %in% input$TD)
  ggplot(filtered, aes(reorder(id, Max.Velocity), Max.Velocity, fill=Sprint_Distance))+geom_bar(stat="summary", fun.y="mean")+scale_fill_gradient2(name="Sprint Distance",low="yellow", mid="green", high="red")+coord_flip()+xlab("Player Name")+ylab("Max Velocity (m/s)")+facet_wrap(~Week2, scale="free_y")+geom_hline(yintercept=5, colour="orange", lty=2, size =3)+geom_hline(yintercept = 7.5, colour="red", lty=1, size=3)

}
)
```


Player Analytics Visuals {data-navmenu="Player Analytics"}
===============================

Column {data-width=200}
--------------------

### Filter Data
Filter By Year and Select the Stats to View
```{r, echo=FALSE, fig.width = 5}
selectInput("Year2", "Year",
            choices = Soccer_data$Year, multiple = TRUE, selected = "2017")

selectInput("player_analytics", "Player(s)", choices = Soccer_data$Name, multiple=TRUE, selected="Kevin Molino")

```

Glossary: xGoals = expected goals; G_xGdiff = Difference between actual goals and expected goals positive is better than negative; Key_Passess = passes that lead directly to a shot; xAssist = expected assist (proportion that goal should have occured based on the pass); A_xAdiff = difference between assists and expected assists; Goal.Ass = sum of goals and assists; xGo_xAs = sum of expected goals and expected assists; Shots_p_96 = shots per 96 minutes (average MLS game); xGoalp96 = expected goals per 96 minutes; KP_p96 = key passes per 96 minutes; xAss_p96 = expected assists per 96 minutes; xG.xA_p96 = sum of expected goals plus expected assists per 96 minutes; xGoals_pShot = expected goals per shot; xA_pKP = expected assists per key pass

Column {.tabset} 
---------------

###Player Stat Tracker
You can search by player or club then sort by the variable you want to look at.
```{r, echo=FALSE, fig.width=5, fig.height=10}
renderPlot({
  filtered <-
  Soccer_data %>%
  filter(Year %in% input$Year2,
         Name %in% input$player_analytics)
    filtered2 <- filtered[, c("Name", "Year", "Shots", "Goals", "xGoals", "G_xGdiff", "Key_Passes", "Assist", "xAssist", "A_xAdiff", "Goal.Ass", "xGo_xAs", "xGoals_pShot", "xA_pKP")]
  filtered2_melt <- melt(filtered2, id.vars=c("Name", "Year"))
ggplot(filtered2_melt, aes(reorder(Name, value), value, fill = variable))+geom_bar(stat="identity")+coord_flip()+xlab("Athlete")+facet_wrap(~Year, scale="free")

})
```


###Player Stat Tracker per 96 minutes

```{r, echo=FALSE, fig.width=5, fig.height=10}
renderPlot({
  filtered <-
  Soccer_data %>%
  filter(Year %in% input$Year2,
         Name %in% input$player_analytics)
    filtered3 <- filtered[, c("Name", "Year", "Shots_p_96", "xGoalp96", "KP_p96", "xAss_p96", "xGoals_pShot", "xA_pKP")]
  filtered3_melt <- melt(filtered3, id.vars=c("Name", "Year"))
ggplot(filtered3_melt, aes(reorder(Name, value), value, fill = variable))+geom_bar(stat="identity")+coord_flip()+xlab("Athlete")+geom_text(aes(Name, value, label=round(value,1)), position=position_stack(vjust=0.5))+facet_wrap(~Year, scale="free")+theme(axis.text.x= element_text( size=24, hjust=1, vjust=-.05),axis.title.x= element_text(size=20),axis.text.y= element_text(size=18, hjust=1, vjust=-.05),axis.title.y= element_text(size=20), legend.text=element_text(size=18), legend.position = "top")



})
```

Player Impact {data-navmenu="Player Analytics"}
===============================

Column {data-width=200}
-----------------------

### Filter Data
Use the sliders to filter the data
```{r, echo=FALSE, fig.width = 5}
sliderInput("Shots", "Shots", 20, 200, 50, step = 10)

sliderInput("KPs", "Key Passes", 10, 110, 20, step =10)

sliderInput("goals", "Goals", 5, 25, 10, step = 5)

```

Glossary: xGoals = expected goals; G_xGdiff = Difference between actual goals and expected goals positive is better than negative; Key_Passess = passes that lead directly to a shot; xAssist = expected assist (proportion that goal should have occured based on the pass); A_xAdiff = difference between assists and expected assists; Goal.Ass = sum of goals and assists; xGo_xAs = sum of expected goals and expected assists; Shots_p_96 = shots per 96 minutes (average MLS game); xGoalp96 = expected goals per 96 minutes; KP_p96 = key passes per 96 minutes; xAss_p96 = expected assists per 96 minutes; xG.xA_p96 = sum of expected goals plus expected assists per 96 minutes; xGoals_pShot = expected goals per shot; xA_pKP = expected assists per key pass


Column {.tabset} 
------------------

###Attacking Specialists

```{r, echo=FALSE, fig.width=4, fig.height=12}
renderPlot({
  filtered_Playmakers <-
  Soccer_data %>%
  filter(Shots > input$Shots,
         Key_Passes > input$KPs,
         Goals > input$goals) %>%
  select(Year:xA_pKP)
    
ggplot(filtered_Playmakers, aes(xGoals_pShot, xA_pKP, label = Name))+geom_point(aes(shape = as.factor(as.character(Year)), colour = Club, size = xGoals), stat="identity" )+ xlab("Expected Goals per Shot")+ ylab("Expected Assists per Key Pass")+geom_label_repel()+scale_shape_discrete(name = "Year")
})

```

###Table

```{r, echo=FALSE, fig.width=5, fig.height=10}
renderDataTable({
  filtered_Playmakers <-
  Soccer_data %>%
  filter(Shots > input$Shots,
         Key_Passes > input$KPs,
         Goals > input$goals) %>%
  select(Year:xA_pKP)
    filtered_Playmakers
}
,options = list(
scrollY = '300px', paging = TRUE, scrollX = TRUE))
```

###Goals versus Goal to expected Goal difference

```{r, echo=FALSE, fig.width=5, fig.height=10}
renderPlot({
  filtered_Playmakers <-
  Soccer_data %>%
  filter(Shots > input$Shots,
         Key_Passes > input$KPs,
         Goals > input$goals) %>%
  select(Year:xA_pKP)
    
ggplot(filtered_Playmakers, aes(Goals, G_xGdiff, label = Name))+geom_rect(data=NULL,aes(xmin=15,xmax=25,ymin=4,ymax=8),
                    fill="lightgreen")+geom_point(aes(shape = as.factor(as.character(Year)), colour = Club, size = Shots), stat="identity" )+ xlab("Goals Scored")+ ylab("Difference in Goals versus expected Goals ")+geom_label_repel()+scale_y_continuous(breaks = c(-6,-4,-2,0,2,4,6,8,10,12))+xlim(5,25)+scale_shape_discrete(name = "Year")
})
```

###Shots versus xGoals per Shot

```{r, echo=FALSE, fig.width=5, fig.height=10}
renderPlot({
  filtered_Playmakers <-
  Soccer_data %>%
  filter(Shots > input$Shots,
         Key_Passes > input$KPs,
         Goals > input$goals) 
    
ggplot(filtered_Playmakers, aes( xGoals_pShot, Shots, colour = Goals, label = Name))+geom_point(aes(shape=as.factor(Year)), stat="identity" )+ xlab("Expected Goals per Shot")+scale_colour_gradient2(low="red", mid="yellow", high="darkgreen", midpoint=10)+ylab("Shots")+geom_label_repel()
})
```




2017 Club Comparisons {data-navmenu="Player Analytics"}
===============================

Column {data-width=150}
-----------------------

### Filter Data

```{r, echo=FALSE, fig.width = 5}

selectInput("Club", "Club", choices = Soccer_data$Club, selected= Soccer_data$Club=="MN")

```

Column {data-width=1200}
-----------------

###Stat Heat Map (Hover over to see the values)

```{r, echo=FALSE, fig.width = 5, fig.height=10}
renderD3heatmap({
  filter_Club <-
    Soccer_data %>%
    filter(Year > 2016,
           Club == input$Club)
   filter_Club2 <- filter_Club[, c("Name", "Minutes", "Shots", "Goals", "xGoals", "G_xGdiff", "Key_Passes", "Assist", "xAssist", "A_xAdiff", "Goal.Ass", "xGo_xAs", "xGoals_pShot", "xA_pKP", "Shots_p_96", "xGoalp96", "KP_p96")]
   
  filter_Club3 <- filter_Club2 %>% remove_rownames %>% column_to_rownames(var="Name")
   
  d3heatmap(filter_Club3, scale="column", colors = "YlOrRd", dendrogram = "none", width = 100, cexRow = .8, cexCol = .8)
  
})

```

Column {data-width=500}
-----------------

```{r, echo=FALSE}
renderDataTable({
filter_Club <-
    Soccer_data %>%
    filter(Year > 2016,
           Club == input$Club)
 
  filter_Club[1:15,c("Name", "Minutes", "xGoals", "Key_Passes")]
})
```



Passing Analytics {data-navmenu="Player Analytics"}
=====================================================

Column {.sidebar}
----------------------

### Filter Data

```{r, echo=FALSE, fig.width = 5}

selectInput("Club2", "Club", choices = Passing$Club, selected= Passing$Club[[220]] , multiple = TRUE)

sliderInput("pass", "Passes", 50, 1000, 100, step = 100)

```

Column {.tabset}
--------------------

###Attacking 3rd

```{r, echo=FALSE}
renderPlot({
filter_pass <-
    Passing %>%
    filter(Club %in% input$Club2,
           Att_3rd_Passes > input$pass)
 
  ggplot(filter_pass, aes(Att_3rd_Passes, Att_3rd_xPRCT, colour=Att_3rd_PRCT_diff, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 1.0)+geom_text(aes(label=Name), vjust = -1 )+geom_text(aes(label=Att_3rd_PRCT), vjust=2)+theme_dark()+xlab("# of Passes in Attacking Third")+ylab("Expected Passing Percentage in Attacking Third")
})
```


###Middle 3rd

```{r, echo=FALSE}
renderPlot({
filter_pass_mid <-
    Passing %>%
    filter(Club %in% input$Club2,
           Middle_3rd_Passes > input$pass)
 
  ggplot(filter_pass_mid, aes(Middle_3rd_Passes, Middle_3rd_xPRCT, colour=Middle_3rd_PRCT_diff, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 1.0)+geom_text(aes(label=Name), vjust = -1 )+geom_text(aes(label=Middle_3rd_PRCT), vjust=2)+theme_dark()+xlab("# of Passes in Middle Third")+ylab("Expected Passing Percentage in Middle Third")
})
```

###Defensive 3rd

```{r, echo=FALSE}
renderPlot({
filter_pass_def <-
    Passing %>%
    filter(Club %in% input$Club2,
           DEF_3rd_Passes > input$pass)
 
  ggplot(filter_pass_def, aes(DEF_3rd_Passes, DEF_3rd_xPRCT, colour=DEF_3rd_PRCT_diff, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 0.0)+geom_text(aes(label=Name), vjust = -1 )+geom_text(aes(label=DEF_3rd_PRCT), vjust=2)+theme_dark()+xlab("# of Passes in Defensive Third")+ylab("Expected Passing Percentage in Defensive Third")
})
```

2018 Passing {data-navmenu="Player Analytics"}
=======================================================

Column {.sidebar}
----------------------

### Filter Data

```{r, echo=FALSE, fig.width = 5}

selectInput("Club3", "Club", choices = Passing2$Club, selected= Passing2$Club[[220]] , multiple = TRUE)

sliderInput("pass2", "Passes", 0, 1000, 100, step = 25)

```

Column {.tabset}
--------------------

###All
```{r, echo=FALSE}
renderPlot({
  Passing2$All_diffPct <- Passing2$All_PassPct*100 - Passing2$All_xPassPct*100
filter_pass <-
    Passing2 %>%
    filter(Club %in% input$Club3,
           All_Passes > input$pass2)
 
  ggplot(filter_pass, aes(All_Passes, All_PassPct*100, colour=All_diffPct, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 1.0)+geom_text(aes(label=Player), vjust = -1 )+geom_text(aes(label=round(All_PassPct*100,1)), vjust=2)+theme_dark()+xlab("# of Passes in Attacking Third")+ylab("Expected Passing Percentage in Attacking Third")+xlim(0, 750)
})
```

###Attacking 3rd

```{r, echo=FALSE}
renderPlot({
  Passing2$ATT_diffPct <- Passing2$ATT_PassPct*100 - Passing2$ATT_xPassPct*100
filter_pass <-
    Passing2 %>%
    filter(Club %in% input$Club3,
           ATT_Passes > input$pass2)
 
  ggplot(filter_pass, aes(ATT_Passes, ATT_xPassPct, colour=ATT_diffPct, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 1.0)+geom_text(aes(label=Player), vjust = -1 )+geom_text(aes(label=round(ATT_PassPct*100,1)), vjust=2)+theme_dark()+xlab("# of Passes in Attacking Third")+ylab("Expected Passing Percentage in Attacking Third")+xlim(0, 200)
})
```


###Middle 3rd

```{r, echo=FALSE}
renderPlot({
  Passing2$Mid_diffPct <- Passing2$Mid_PassPct*100 - Passing2$Mid_xPassPct*100
filter_pass_mid <-
    Passing2 %>%
    filter(Club %in% input$Club3,
           Mid_Passes > input$pass2)
 
  ggplot(filter_pass_mid, aes(Mid_Passes, Mid_xPassPct, colour=Mid_diffPct, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 1.0)+geom_text(aes(label=Player), vjust = -1 )+geom_text(aes(label=round(Mid_PassPct*100,1)), vjust=2)+theme_dark()+xlab("# of Passes in Middle Third")+ylab("Expected Passing Percentage in Middle Third")+xlim(0,200)
})
```

###Defensive 3rd

```{r, echo=FALSE}
renderPlot({
  Passing2$DEF_diffPct <- Passing2$DEF_PassPct*100 - Passing2$DEF_xPassPct*100
filter_pass_def <-
    Passing2 %>%
    filter(Club %in% input$Club3,
           DEF_Passes > input$pass2)
 
  ggplot(filter_pass_def, aes(DEF_Passes, DEF_xPassPct, colour=DEF_diffPct, shape=Club))+geom_point(size=4)+scale_color_gradient2(name="Percent diff \nin passing accuracy", low="red", mid="yellow", high="green", midpoint= 0.0)+geom_text(aes(label=Player), vjust = -1 )+geom_text(aes(label=round(DEF_PassPct*100,1)), vjust=2)+theme_dark()+xlab("# of Passes in Defensive Third")+ylab("Expected Passing Percentage in Defensive Third")+xlim(0, 400)
})
```


###Team Comparison

```{r,echo=FALSE}
renderPlot({
  Passing2$All_diffPct <- Passing2$All_PassPct*100 - Passing2$All_xPassPct*100
  filter_clubs <-
    Passing2 %>%
    filter(Club %in% input$Club3)
  
 dist <- ggplot(filter_clubs, aes(All_Distance, fill=Club))+geom_density(stat="density", alpha= 0.5)+xlab("Avg Pass Distance (All Passes)")
 vert <- ggplot(filter_clubs, aes(All_Vertical, fill=Club))+geom_density(stat="density", alpha= 0.5)+xlab("Avg Pass Vertical Distance (All Passes)")
 diff <- ggplot(filter_clubs, aes(All_diffPct, fill=Club))+geom_density(stat="density", alpha= 0.5)+xlab("Difference between Pass Efficiency and Expected Pass Efficiency")
 score <- ggplot(filter_clubs, aes(All_Score, fill=Club))+geom_density(stat="density", alpha= 0.5)+xlab("Extra Completed Passes")
  gridExtra::grid.arrange(dist,vert,diff,score, ncol=2)
})

```
